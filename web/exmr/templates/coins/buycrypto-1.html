{% extends 'accounts/dashboard-base.html' %} {% load staticfiles widget_tweaks i18n %}
<div></div>
{% load transaction_status %} {% block dashboard_heading %}<h4 class="text-theme b-4 dashboard">WALLET</h4>
{% endblock %} {% block dashboard_wrapper_content %}

<section class="section section-pad" style="padding-bottom: 1em; padding-top: 1em">
    <div class="container">
        <div class="row bx-ash text-center" style="color: white">
            <div class="col-12 text-center pt-1 px-5 pb-5 ">
                <h1>Buy {{sel_coin}}</h1>
            </div>
            <div class="col-12">
                <form method="POST" action=".">
                    {% csrf_token %}
                    <div class="col-12">
                        <span style="float: left; font-size: 20px;">0$</span>
                        <span style="float: right; font-size: 20px;">5000$</span>
                    </div>
                    <div class="col-12" style="padding-top: 13px;">
                        <input type="range" min="10" max="5000" value="50" link-to="text_box_name" id="rangeslider" style="width: 100%">
                    </div>
                    <br><br>
                    <div class="row" >
                        <div class="col-12 col-sm-6">
                            <label>USD: </label>
                            <input type="text" style="color: white" name="usd_value"  id="input_usd_value" class="value textfield-style1">
                        </div>
                        <div class="col-12 col-sm-6">
                            <label>{{ view.kwargs.currency }}:</label>
                            <input style="color: white" type="text" name="coin_value" id="input_coin_value" class="value textfield-style1">
                        </div>
                        <div class="col-12 p-5">
                            <input  type="submit" class="btn btn-success" value="Buy Coin">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- <div class="p-5 text-center">
    <div class="col-xs-12 text-center pt-1 px-5 pb-5 ">
        <h1>Buy {{sel_coin}}</h1>
    </div>
    <form method="POST" action=".">
        {% csrf_token %}
        <div class="col-xs-12">
            <span class="floatl">0$</span>
            <span class="floatr">5000$</span>
        </div>
        <input type="range" min="10" max="5000" value="50" link-to="text_box_name" id="rangeslider">

        <br><br>
        <div class="col-xs-12 col-sm-6">
            <label>USD: </label>
            <input type="text"  name="usd_value"  id="input_usd_value" class="value textfield-style1">
        </div>
        <div class="col-xs-12 col-sm-6">
            <label>{{ view.kwargs.currency }}:</label>
            <input type="text" name="coin_value" id="input_coin_value" class="value textfield-style1">
        </div>
        <div class="col-xs-12 p-5">
            <input type="submit" class="btn btn-success" value="Buy Coin">
        </div>
    </form>

</div> -->
{% endblock %} {% block script %}

<script type="text/javascript">
    var elem = document.querySelector('input[type="range"]');
    var rangeValue = function () {
        var newValue = elem.value;
        var target = document.querySelector('#input_usd_value');
        target.value = newValue;
        convert_to_usd();
    }
    elem.addEventListener("input", rangeValue);
</script>
<script>
    $('#input_usd_value').on('change keyup paste', function () {
        var elem = document.querySelector('#input_coin_value');
        var newValue = elem.value;
        if (newValue > 5000) {
            elem.value = 5000;
        }
        target = document.querySelector('#rangeslider');
        target.value = newValue;
        convert_to_usd();
    });
</script>

<script type="text/javascript">

function convert_to_usd(){

    $.ajax({
                type: "GET",
                url: "{% url 'coins:currency_convert' %}",
                data: {
                    'to': "{{ view.kwargs.currency }}",
                },
                success: function (data) {
                    usd = parseInt($('#input_usd_value').val());
                    console.log(data["value"]*usd)
                    $("#input_coin_value").val(data["value"]*usd)
                }
            })

}

$.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    return results[1] || 0;
}


if ($.urlParam('error'))
    alert("Currently we have insufficient funds. Please try with lesser amount.")
</script>
{% endblock %}